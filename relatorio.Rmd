---
title: "Análise de Questionários do Projeto 'Meninas na Computação'"
output:
  html_notebook: 
    code_folding: hide
  html_document: default
---
```{r, include=FALSE}
rm(list = ls())
options("scipen"=100, "digits"=2)

# install.packages("readxl")
library(readxl)

# install.packages("readr")
library(readr)

#install.packages("arules")
library(arules)

# install.packages("ggplot2")
library(ggplot2)

# install.packages("reshape2")
library(reshape2)

# install.packages("gridExtra")
library(gridExtra)

# install.packages("stringr")
library(stringr)

# install.packages("knitr")
library(knitr)

# install.packages("agricolae")
library(agricolae)
```

Este estudo é uma análise estatística sobre o projeto [Meninas na Computação](http://meninas.cic.unb.br/), coordenado pela professora Dra. Maristela Terto e Holanda et al. 

```{r}
respostas <- read_excel("raw.xlsx", sheet = "unificado", na = "")

respostas$Q1 <- NULL
respostas$Q2 <- NULL
respostas$Serie <- stringr::str_trim(respostas$Serie, side = "both")
respostas <- as.data.frame(lapply(respostas, as.factor))
opcao <- data.frame(Fara_Computacao = levels(respostas$Fara_Computacao), opcao_computacao = c(1, 2, 3))
respostas <- merge(respostas, opcao)

respostas <- respostas[, c(37, 1:36)]
```

Durante os anos de 2011 a 2014, foram entrevistados `r nrow(respostas)` alunos do nível fundamental, médio e superior, sobre o curso superior que pretendiam seguir. 

O questionário possui 14 questões que foram desmembradas em 36 variáveis.

O primeiro passo do estudo foi recuperar as respostas dos questionários. 

O segundo passo envolveu a preparação dos dados. Em primeiro lugar, os questionários foram unificados em uma única tabela, a fim de facilitar a manipulação.

Como o estudo consiste em identificar as motivações das alunas entrevistadas em seguir ou não uma carreira em Ciência da Computação, foram retirados os `r nrow(respostas[respostas$Sexo == 'M',])` entrevistados de sexo masculino.

```{r}
respostas <- subset(respostas, respostas$Sexo == "F")
respostas$Sexo <- NULL
```

São encontradas as seguintes distribuições de série na amostra:

```{r}
series <- aggregate(x = list(Quantidade = respostas$Serie), by = list(Ano = respostas$Ano, Serie = respostas$Serie), FUN=length)

por_ano <- aggregate(x = list(Total = respostas$Serie), by = list(Ano = respostas$Ano), FUN=length)

series <- merge(series, por_ano)

series$Percentual <- series$Quantidade * 100 / series$Total

p = ggplot(data = series, aes(x = "", y = Percentual, fill = Serie))  
p = p + geom_bar(width = 1, stat = "identity")
p = p + facet_grid(facets = . ~ Ano)
p = p + coord_polar(theta = "y", start = 0) 
p = p + scale_x_discrete()
p = p + xlab("") + ylab("") + labs(fill="Ano") 
p = p + ggtitle("Percentual de Entrevistadas por Série em cada Ano")
p
```

As alunas responderam da seguinte forma sobre a área que gostariam de cursar:

```{r}
cursos <- aggregate(x = list(Quantidade = respostas$Fara_Curso_Superior), by = list(Ano = respostas$Ano, Fara_Curso_Superior = respostas$Fara_Curso_Superior), FUN=length)

por_ano <- aggregate(x = list(Total = respostas$Fara_Curso_Superior), by = list(Ano = respostas$Ano), FUN=length)

cursos <- merge(cursos, por_ano)

cursos$Percentual <- cursos$Quantidade * 100 / cursos$Total

p = ggplot(data = cursos, aes(x = "", y = Percentual, fill = Fara_Curso_Superior))  
p = p + geom_bar(width = 1, stat = "identity")
p = p + facet_grid(facets = . ~ Ano)
p = p + coord_polar(theta = "y", start = 0) 
p = p + scale_x_discrete()
p = p + xlab("") + ylab("") + labs(fill="Ano") 
p = p + ggtitle("Percentual de Entrevistadas por Área de Interesse")
p
```

Podemos observar que os percentuais permanecem ao longo dos anos, sendo a preferência por Ciências Biológicas e de Saúde em torno de `r round(cursos$Percentual[cursos$Ano == 2011 & cursos$Fara_Curso_Superior == 'Biologicas e Saude'])`\%, para Humanas cerca de `r round(cursos$Percentual[cursos$Ano == 2011 & cursos$Fara_Curso_Superior == 'Humanas'])`\% e para Exatas próximo a `r round(cursos$Percentual[cursos$Ano == 2011 & cursos$Fara_Curso_Superior == 'Exatas'])`\%.

A opinião das alunas sobre o cursar Ciência da Computação é representada nos gráficos a seguir:

```{r}
comp <- aggregate(x = list(Quantidade = respostas$Fara_Computacao), by = list(Ano = respostas$Ano, Fara_Computacao = respostas$Fara_Computacao), FUN=length)

por_ano <- aggregate(x = list(Total = respostas$Fara_Computacao), by = list(Ano = respostas$Ano), FUN=length)

comp <- merge(comp, por_ano)

comp$Percentual <- comp$Quantidade * 100 / comp$Total

p = ggplot(data = comp, aes(x = "", y = Percentual, fill = Fara_Computacao))  
p = p + geom_bar(width = 1, stat = "identity")
p = p + facet_grid(facets = . ~ Ano)
p = p + coord_polar(theta = "y", start = 0) 
p = p + scale_x_discrete()
p = p + xlab("") + ylab("") + labs(fill="Ano") 
p = p + ggtitle("Percentual de Entrevistadas por Interesse em Computação")
p
```

Será realizada a seguir uma análise de variância, no intuito de identificar, pergunta a pergunta, se as quantidades médias das respostas são estatisticamente diferentes ou se a diferença identificada nas médias trata-se de ruído. 

A análise de variância não será completa sem um teste de comparação de médias: após identificar diferenças reais entre as respostas, será efetuado o teste de Tukey que dirá quais dos itens são diferentes entre si.

Para que seja feita a análise de variância, a amostra deve atender certas pressuposições básicas:
1) os erros são variáveis aleatórias independentes;
2) a variância é constante;
3) a distribuição dos erros é normal ou aproximadamente normal.

Os gráficos que apóiam essas pressuposições serão movidos para o fim da página.

Como exemplo, será efetuada isoladamente a análise de variância do atributo **opcao_computacao** em relação ao atributo **Ano**, com os anos como tratamentos. A variável observada é o interesse do aluno por optar pelo curso de ciência da computação, sendo atribuído o valor 1 no caso em que a estudante respondeu que não fará vestibular para computação, 2 se ainda está em dúvida e 3 se informou que irá optar por computação.

```{r}
temp <- data.frame(Tratamento = respostas[, 3], Opcao_Computacao = respostas[, 1])

fit <- aov(Opcao_Computacao ~ Tratamento, data = temp)
knit_print(anova(fit))
cat("\n")

knit_print(HSD.test(fit, 'Tratamento'))

par(mfrow=c(2,2))
plot(fit)
```

A partir do p-valor do tratamento **Ano** (Pr(>F)) abaixo de 5%, há evidências de uma diferença na quantidade de alunas que optam por computação devido à passagem do tempo.

Contudo, ao efetuar o teste de Tukey, percebemos que não há diferença real entre o ano de 2011 e os demais. Desta forma, concluímos que há constância na indecisão das alunas.

A seguir serão apresentadas as análises de variância dos outros atributos coletados nas entrevistas.

```{r}

for (i in 4:ncol(respostas)) {
  temp <- data.frame(Tratamento = respostas[, i], Opcao_Computacao = respostas[, 1])
  
  nome <- colnames(respostas)[i]
  cat(paste("\nTratamento:", nome, "\n"))  
  cat("\n")
  
  fit <- aov(Opcao_Computacao ~ Tratamento, data = temp)
  knit_print(anova(fit))
  cat("\n")

  knit_print(HSD.test(fit, 'Tratamento'))
  
  # assign(nome, temp)

  par(mfrow=c(2,2))  
  plot(fit)
}
```


A partir da análise de variância e do teste de Tukey dos atributos, identificamos o seguinte:

Sobre o atributo **Série**, devemos descartar a informação sobre as estudantes de Supletivo, devido à baixa quantidade de respondentes. Normalmente se descartam tratamentos com menos de 30 ocorrências. Podemos perceber dois grupos: do Ensino Fundamental até o Segundo Ano há uma tendência levemente positiva em relação ao curso de computação; por outro lado, alunas do Terceiro Ano e que já cursam o Nível Superior possuem leve rejeição pelo curso.

Em relação à intenção de fazer um curso superior, atributo **Fara_Curso_Superior**, as estudantes que informaram predileção por Exatas, Biológicas e Saúde possuem uma leve tendência a optar por computação, enquanto as que marcaram Humanas tem dúvida sobre uma carreira em computação.

O atributo **Somente_Ensina_Software** mostra que as estudantes que acreditam em tal afirmação tem tendência a optar por um curso de computação, enquanto as que acreditam no contrário ou não tem certeza ficaram em dúvida sobre cursar computação.

Um dos resultados mais desconcertantes refere-se ao atributo **Pouca_Matematica**: apesar da maioria das entrevistadas acreditar de que o curso de computação baseia-se em muito conteúdo matemático, uma quantidade considerável de respondentes discorda. O elemento contraditório é que estas últimas tem certa tendência em seguir uma carreira em computação!

Outro resultado conflitante está relacionado à afirmação de que nos cursos de computação há muitos homens, atributo **Maioria_Homens**. As entrevistadas que discordam dessa afirmação pretendem cursar ciência da computação.

Sobre o domínio de uso do computador ser um pré-requisito para o curso de computação, atributo **Precisa_Saber_Usar_Computador**, a decisão sobre cursar ou não ciência da computação ficou equilibrada em relação a esse quesito.

O atributo **Precisa_Curso_Superior** está relacionado à necessidade de uma graduação para exercer a profissão de cientista da computação. As estudantes que acreditam nessa afirmativa tem uma leve tendência a optar pelo curso de computação. Já as que não acreditam ou tem dúvida estão indecisas sobre o cursar computação.

O atributo mais marcante neste estudo foi **Familia_Gostaria_Computacao**. Nesse, é possível perceber claramente a influência familiar na decisão do curso superior: estudantes que acreditam que a família ficaria feliz caso elas optassem por computação tem uma forte tendência em realmente escolher o curso. As entrevistadas que acreditam que a família não apoiaria a escolha desse curso tem uma tendência a rejeitar a computação. As que não tem certeza da opinião da família também não tem certeza sobre o desejo de seguir essa carreira.

O atributo **Dificuldade_Emprego**, origina-se da percepção das estudantes de que uma pessoa que trabalha na área de computação tem dificuldades em empregar-se. Houve pouca quantidade de entrevistadas que acreditava nessa afirmação mas, no geral, as estudantes que ficaram indecisas sobre cursar computação.

O atributo **Pouco_Lazer**, originário da pergunta "Quem trabalha com computação tem poucas horas de lazer?", teve resultados semelhantes ao atributo **Dificuldade_Emprego**, percebendo-se uma forte indecisão na opção do curso, independentemente da percepção de quantidade de lazer.

Os atributos **Usa_Criatividade**, **Da_Prestigio**, **Boa_Remuneracao** e **Atuacao_Outras_Areas** parecem-se muito com os atributos **Dificuldade_Emprego** e **Pouco_Lazer**, denotando que as entrevistadas ainda não preocupam-se com esses atributos na hora de escolher o curso superior.

O atributo **Usa_Computador_Propria_Casa**, que é auto-explicativo, mostra que alunas que não usam ou não possuem o computador em suas casas estão muito propensas a fazer um curso de computação! As estudantes que usam do equipamento em seu domicílio mostram-se indecisas sobre a opção pelo curso.

Os atributos **Usa_Computador_Casa_Parentes** e **Usa_Computacao_Casa_Amigos** tem pouca relevância na decisão por um curso de computação.

O não uso do computador na escola, atributo **Usa_Computador_Escola** gera um efeito inverso, isto é, alunas que não usam o equipamento em aula mostram leve tendência em optar por computação.

Usar ou não usar o computador no trabalho, atributo **Usa_Computador_Trabalho**, parece não ter relevância na escolha do curso de computação.

Usar o computador em uma *Lan House* tem um efeito positivo na opção pelo curso de computação. 

Usar ou não usar o computador na biblioteca, atributo **Usa_Computador_Biblioteca**, não tem relevância na opção por cursar computação.

Usar o computador em um *Centro de Inclusão Digital* tem um efeito positivo semelhante a usar em uma *Lan House*, movendo a vontade das alunas para a ciência da computação.

O uso de aplicações de escritório, como *editores de texto*, *planilhas eletrônicas* e *editores de imagens* não tem impacto na escolha do curso de computação.

Contudo, o uso de *banco de dados* e a criação de *programas de computador* tem influência positiva na decisão por cursar ciência da computação.

O **não** uso de *internet*, *redes sociais* e *e-mail* motiva as estudantes a optar pelo curso de computação.

O uso de jogos de computador, atributo **Usa_Jogos**, não tem relevância na escolha do curso de computação.

*Desenvolver páginas web* e *utilizar outros softwares* tem uma pequena relevância na escolha do curso de computação.

Iremos agora criar um modelo de análise de variância levando em consideração todas as variáveis do questionário, adotando uma abordagem *top-down*, isto é, iterando sobre o modelo e retirando as variáveis menos significativas, até que todas as variáveis sejam significativas.

```{r}
temp <- respostas[, c(1, 3:ncol(respostas))]

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```


Novo modelo, retirando variável **Usa_Computador_Biblioteca**:

```{r}
temp$Usa_Computador_Biblioteca <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Email**:

```{r}
temp$Usa_Email <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Editor_Texto**:

```{r}
temp$Usa_Editor_Texto <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Outros_Softwares**:

```{r}
temp$Usa_Outros_Softwares <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Criatividade**:

```{r}
temp$Usa_Criatividade <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Computador_Trabalho**:

```{r}
temp$Usa_Computador_Trabalho <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Redes_Sociais**:

```{r}
temp$Usa_Redes_Sociais <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Computador_Casa_Parentes**:

```{r}
temp$Usa_Computador_Casa_Parentes <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Editor_Imagem**:

```{r}
temp$Usa_Editor_Imagem <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Internet**:

```{r}
temp$Usa_Internet <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Pouco_Lazer**:

```{r}
temp$Pouco_Lazer <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Desenvolve_Paginas_Web**:

```{r}
temp$Desenvolve_Paginas_Web <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Planilha_Eletrônica**:

```{r}
temp$Usa_Planilha_Eletrônica <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Computador_Casa_Amigos**:

```{r}
temp$Usa_Computador_Casa_Amigos <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```

Retirando variável **Usa_Jogos**:

```{r}
temp$Usa_Jogos <- NULL

fit <- aov(opcao_computacao ~ ., data = temp)
knit_print(anova(fit))
par(mfrow=c(2,2))
plot(fit)
```



O próximo passo é identificar se há combinações de atributos que expliquem essa opção. Para isso será utilizado o algoritmo Apriori de mineração de regras de associação.

```{r}
# regras = apriori(data = respostas[, 2:36], parameter = list(minlen=2, supp=0.1, conf=0.8, maxtime=600))

# regras.ordem <- sort(regras, by="lift")

# Encontrando as regras redundantes
# subset.matrix <- is.subset(regras.ordem, regras.ordem)
# subset.matrix[lower.tri(subset.matrix, diag = T)] = NA

# Vejam o que montamos até aqui
# subset.matrix[1:5,1:5]


# write(regras, file="regras.txt")
```

